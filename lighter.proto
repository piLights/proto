syntax = "proto3";

option java_multiple_files = true;
option java_package = "de.grunicke.lighter";

package LighterGRPC;

service Lighter {
    rpc setColor(ColorMessage) returns (Confirmation) {};
    rpc checkConnection(InitMessage) returns (stream ColorMessage) {};
    rpc switchState(StateMessage) returns (Confirmation) {};
    rpc loadServerConfig(LoadConfigRequest) returns (ServerConfig) {};
    rpc changeServerParameter(ChangeParameterMessage) returns (Confirmation) {};
    rpc scheduleSwitchState(ScheduledSwitch) returns (Confirmation) {};
    rpc logEntryList() returns (LogList) {};
}

message ColorMessage {
    bool onstate = 1;
    int32 r = 2;
    int32 g = 3;
    int32 b = 4;
    int32 opacity = 5;
    string deviceID = 6;
    string password = 7;
}


message StateMessage {
    bool onstate = 1;
    string deviceID = 2;
    string password = 3;
}

message Confirmation {
    bool success = 1;
}

message InitMessage {
    string deviceID = 1;
    string password = 2;
}

message LoadConfigRequest {
    string deviceID = 1;
    string password = 2;
}

message ServerConfig {
    string serverName = 1;
    FadeTime fadeTime = 2;
    IPVersion ipVersion = 3;
}

message ChangeParameterMessage {
    string password = 1;
    oneof parameter {
        string serverName = 2;
        FadeTime fadeTime = 3;
        IPVersion ipversion = 4;
        Pins pins = 5;
    }
}

message FadeTime {
    int32 millis = 1;
}

message IPVersion {
    enum Version {
        DUAL = 0;
        IPV4ONLY = 1;
        IPV6ONLY = 2;
    }
    Version version = 1;
}

message Pins {
    int32 redPin = 1;
    int32 greenPin = 2;
    int32 bluePin = 3;
    int32 whitePin = 4;
}

message ScheduledSwitch {
    int64 time = 1;
    bool onstate = 2;
    string deviceID = 3;
    string password = 4;
}

message LogList {
    int64 count = 1;
    repeated LogEntry EntryList = 2;
}

message LogEntry {
    int64 time = 1;
    LogLevel logLevel = 2;
    string message = 3;
}

enum LogLevel {
    TRACE = 1;
    DEBUG = 2;
    INFO = 3;
    WARN = 4;
    ERROR = 5;
}
